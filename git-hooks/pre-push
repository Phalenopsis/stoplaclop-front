#!/bin/bash
# --- git-hooks/pre-push ---
# EmpÃªche le push direct sur main ou dev

# Lecture de la rÃ©fÃ©rence actuelle (branche locale) et de la cible distante
while read local_ref local_sha remote_ref remote_sha
do
  branch_name=$(git rev-parse --abbrev-ref HEAD)

  # Bloque si on tente de pousser directement sur main ou dev
  if [[ "$branch_name" == "main" || "$branch_name" == "dev" ]]; then
    echo "âŒ Push direct sur '$branch_name' interdit !"
    echo "ğŸ‘‰ CrÃ©e une branche de fonctionnalitÃ©, par ex : feat/ma-fonction"
    exit 1
  fi

  # VÃ©rifie le pattern de nommage
  if ! [[ "$branch_name" =~ ^(feat|fix|hotfix)/.+$ ]]; then
    echo "âŒ Nom de branche invalide pour le push : '$branch_name'."
    echo "ğŸ‘‰ Seules les branches feat/, fix/, hotfix/ sont autorisÃ©es."
    exit 1
  fi
done

echo "âœ… VÃ©rification pre-push rÃ©ussie : branche autorisÃ©e."
exit 0
